<!--- #PRODUCTS -->

<section class="section product color-scheme-{{ section.settings.color_scheme }}" style="{% render 'color-scheme-styles', scheme: section.settings.color_scheme %}" id="product" aria-label="product" data-aos="fade-up">
  <div class="container">

    <div class="title-wrapper">
      <h2 class="h2 section-title">Popular Products</h2>

      <ul class="filter-btn-list">
        <li class="filter-btn-item">
          <button class="filter-btn" data-filter-btn="accessory">Men's</button>
        </li>

        <li class="filter-btn-item">
          <button class="filter-btn" data-filter-btn="decoration">Women's</button>
        </li>

        <li class="filter-btn-item">
          <button class="filter-btn" data-filter-btn="furniture">Unisex</button>
        </li>

      </ul>
    </div>

    <ul class="product-slider">
          {% assign collection_handle = 'all' %}
          {% for product in collections[collection_handle].products limit:8 %}
            <li class="decoration">
              <div class="product-card">
                <a href="{{ product.url }}" class="card-banner img-holder has-before" style="--width: 300; --height: 300;">
                  {% if product.featured_image %}
                    <img src="{{ product.featured_image | image_url: width: 600 }}" 
                      srcset="{{ product.featured_image | image_url: width: 300 }} 300w,
                              {{ product.featured_image | image_url: width: 450 }} 450w,
                              {{ product.featured_image | image_url: width: 600 }} 600w"
                      sizes="(max-width: 480px) 100vw, (max-width: 768px) 50vw, 25vw"
                      alt="{{ product.featured_image.alt | escape }}" 
                      class="img-cover" 
                      width="300" 
                      height="300" 
                      loading="lazy">
                      <ul class="card-action-list">

                        <li>
                          <button class="card-action-btn" aria-label="add to cart" title="add to cart">
                            {% render 'icon-velour', icon: 'add' %}
                          </button>
                        </li>
    
                        <li>
                          <form action="/cart/add" method="post" enctype="multipart/form-data" onsubmit="submitAddToCartForm(this); return false;">
                            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                            <button type="submit" class="card-action-btn" aria-label="add to cart" title="add to cart">
                              {% render 'icon-velour', icon: 'bag-handle' %}
                            </button>
                          </form>
                        </li>
                      </ul>
    
                      <ul class="badge-list">
                        <li>
                          <div class="badge cyan">-10%</div>
                        </li>
    
                      </ul>
                  {% else %}
                    {{ 'product-1' | placeholder_svg_tag: 'img-cover' }}
                  {% endif %}
                </a>
                <div class="card-content">
                  <h3 class="h3">
                    <a href="{{ product.url }}" class="card-title">{{ product.title }}</a>
                  </h3>
                  <div class="card-price">
                    {% if product.compare_at_price > product.price %}
                      <del class="del">{{ product.compare_at_price | money }}</del>
                    {% endif %}
                    <data class="price" value="{{ product.price }}">{{ product.price | money }}</data>
                  </div>
                </div>
              </div>
            </li>
          {% endfor %}
    </ul>

    <div class="slider-nav">
      <button class="slider-prev" aria-label="Previous">&larr;</button>
      <button class="slider-next" aria-label="Next">&rarr;</button>
    </div>

  </div>
</section>

<style>
.product-slider {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  gap: 15px;
  padding-bottom: 10px;
  scrollbar-width: none;
  list-style: none;
  padding-left: 0;
  margin: 0;
}
.product-slider::-webkit-scrollbar {
  display: none;
}
.product-slider > li {
  flex: 0 0 calc(25% - 12px);
  scroll-snap-align: start;
}
.product-card {
  text-align: center;
  padding: 10px;
}
.slider-nav {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 15px;
}
.slider-nav button {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--smokey-black, #000);
  color: #fff;
  border: none;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s;
}
.slider-nav button:hover { opacity: 0.7; }

@media (max-width: 1024px) {
  .product-slider > li { flex: 0 0 calc(33.33% - 10px); }
}
@media (max-width: 768px) {
  .product-slider > li { flex: 0 0 calc(50% - 8px); }
}
@media (max-width: 480px) {
  .product-slider > li { flex: 0 0 100%; }
}
</style>

<script>
(function() {
  'use strict';
  document.addEventListener('DOMContentLoaded', function() {
    const section = document.querySelector('.section.product-list'); // Assuming a unique class or using ID
    const slider = section?.querySelector('.product-slider');
    if (!slider) return;

    const getScrollAmount = () => {
      const firstItem = slider.querySelector('li');
      return firstItem ? firstItem.offsetWidth + 15 : 300;
    };

    // Delegation for controls
    section.addEventListener('click', function(event) {
      if (event.target.closest('.slider-next')) {
        slider.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
      } else if (event.target.closest('.slider-prev')) {
        slider.scrollBy({ left: -getScrollAmount(), behavior: 'smooth' });
      }
    });

    // Optimized Autoplay
    let autoplayInterval;
    const startAutoplay = () => {
      autoplayInterval = setInterval(() => {
        const maxScroll = slider.scrollWidth - slider.clientWidth;
        if (slider.scrollLeft >= maxScroll - 5) {
          slider.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          slider.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
        }
      }, 4000);
    };

    const stopAutoplay = () => clearInterval(autoplayInterval);

    slider.addEventListener('mouseenter', stopAutoplay);
    slider.addEventListener('mouseleave', startAutoplay);
    startAutoplay();
  });
})();
</script>

{% schema %}
{
  "name": "Collection banner",
  "settings": [
    {
      "type": "color_scheme","id": "color_scheme","label": "Color scheme","default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "collection_section",
      "name": "Collection section",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Section Title",
          "default": "Discover What's New"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        },
        {
          "type": "url",
          "id": "button_url",
          "label": "Button URL",
          "default": "/collections/all"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Shop All Products"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection banner",
      "category": "Custom",
      "blocks": [
        {
          "type": "collection_section",
          "settings": {
            "title": "Discover What's New",
            "collection": "new-arrivals-1",
            "button_url": "/collections/new-arrivals",
            "button_label": "Shop Now"
          }
        },
        {
          "type": "collection_section",
          "settings": {
            "title": "Top Trending",
            "collection":"trending",
            "button_url": "/collections/trending",
            "button_label": "Shop Now"
          }
        }
      ]
    }
  ]
}
{% endschema %}
