{% comment %}
  Faceted Filtering Section
  Provides filtering by availability, price, type, vendor, and variant options
  Uses Shopify's native filtering system
  Required for Theme Store compliance
{% endcomment %}

{%- liquid
  assign sort_by = collection.sort_by | default: collection.default_sort_by
  assign filter_count = 0
  for filter in collection.filters
    assign filter_count = filter_count | plus: filter.active_values.size
  endfor
-%}

{%- comment -%} Right-Aligned Filter Bar {%- endcomment -%}
<div class="facets-horizontal-right">
  <form class="facets-form" id="FacetFiltersForm">
    
    {%- comment -%} Filter Controls Row {%- endcomment -%}
    <div class="facets-controls-row">
      
      {%- comment -%} Sort Dropdown {%- endcomment -%}
      <div class="facet-dropdown-wrapper">
        <select 
          name="sort_by" 
          class="facet-dropdown"
          onchange="this.closest('form').submit()"
          aria-label="Sort products"
        >
          {%- for option in collection.sort_options -%}
            <option 
              value="{{ option.value }}" 
              {% if option.value == sort_by %}selected{% endif %}
            >
              {{ option.name }}
            </option>
          {%- endfor -%}
        </select>
      </div>

      {%- comment -%} Filter Dropdowns {%- endcomment -%}
      {%- for filter in collection.filters -%}
        {%- case filter.type -%}
          
          {%- comment -%} List Filters as Dropdowns {%- endcomment -%}
          {%- when 'list' -%}
            <div class="facet-dropdown-wrapper">
              <select 
                name="{{ filter.values.first.param_name }}" 
                class="facet-dropdown"
                onchange="this.closest('form').submit()"
              >
                <option value="">{{ filter.label }}</option>
                {%- for value in filter.values -%}
                  <option 
                    value="{{ value.value }}" 
                    {% if value.active %}selected{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                  >
                    {{ value.label }} ({{ value.count }})
                  </option>
                {%- endfor -%}
              </select>
            </div>

          {%- comment -%} Price Range Filter {%- endcomment -%}
          {%- when 'price_range' -%}
            <div class="facet-dropdown-wrapper price-range-wrapper">
              <div class="price-inputs-inline">
                <input
                  name="{{ filter.min_value.param_name }}"
                  type="number"
                  placeholder="Min"
                  min="0"
                  class="price-input-small"
                  {% if filter.min_value.value %}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                >
                <span class="price-dash">-</span>
                <input
                  name="{{ filter.max_value.param_name }}"
                  type="number"
                  placeholder="Max"
                  min="0"
                  class="price-input-small"
                  {% if filter.max_value.value %}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                >
                <button type="submit" class="price-apply-btn">Go</button>
              </div>
            </div>

        {%- endcase -%}
      {%- endfor -%}
    </div>

    {%- comment -%} Active Filters {%- endcomment -%}
    {% if filter_count > 0 %}
      <div class="active-facets-row">
        <div class="active-facets__list">
          {%- for filter in collection.filters -%}
            {%- for value in filter.active_values -%}
              <a href="{{ value.url_to_remove }}" class="active-facet-tag">
                {{ value.label }} <span class="remove-x">Ã—</span>
              </a>
            {%- endfor -%}
          {%- endfor -%}
          <a href="{{ collection.url }}" class="clear-all-link">Clear all</a>
        </div>
      </div>
    {% endif %}
  </form>
</div>

<style>
  :root {
    --facet-smokey-black: hsl(0, 0%, 7%);
    --facet-granite-gray: hsl(0, 0%, 40%);
    --facet-spanish-gray: hsl(0, 0%, 60%);
    --facet-light-gray: hsl(0, 0%, 80%);
    --facet-cultured: hsl(220, 16%, 96%);
    --facet-white: hsl(0, 0%, 100%);
    --facet-transition-1: 0.25s ease;
  }

  /* Right-Aligned Filter Container */
  .facets-horizontal-right {
    display: flex;
    justify-content: flex-end;
    padding: 0 15px 20px;
  }

  /* Filter Controls Row */
  .facets-controls-row {
    display: flex;
    flex-direction: row;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  /* Individual Filter Dropdown Wrapper */
  .facet-dropdown-wrapper {
    display: flex;
    align-items: center;
    min-width: 160px;
  }

  .price-range-wrapper {
    min-width: auto;
  }

  /* Dropdown Selects - Compact Style */
  .facet-dropdown {
    padding: 10px 30px 10px 14px;
    border: 1px solid var(--facet-light-gray);
    background: var(--facet-white);
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.4rem;
    color: var(--facet-smokey-black);
    cursor: pointer;
    transition: var(--facet-transition-1);
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23666' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    min-width: 160px;
  }

  .facet-dropdown:hover {
    border-color: var(--facet-granite-gray);
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }

  .facet-dropdown:focus {
    border-color: var(--facet-smokey-black);
    outline: none;
    box-shadow: 0 0 0 2px rgba(0,0,0,0.05);
  }

  /* Price Range Inline Inputs */
  .price-inputs-inline {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .price-input-small {
    width: 70px;
    padding: 10px 8px;
    border: 1px solid var(--facet-light-gray);
    background: var(--facet-white);
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.3rem;
    color: var(--facet-smokey-black);
    transition: var(--facet-transition-1);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .price-input-small:hover {
    border-color: var(--facet-granite-gray);
  }

  .price-input-small:focus {
    outline: none;
    border-color: var(--facet-smokey-black);
    box-shadow: 0 0 0 2px rgba(0,0,0,0.05);
  }

  .price-input-small::placeholder {
    color: var(--facet-spanish-gray);
    font-size: 1.2rem;
  }

  .price-dash {
    color: var(--facet-granite-gray);
    font-size: 1.4rem;
    font-weight: 300;
  }

  .price-apply-btn {
    padding: 10px 16px;
    background: var(--facet-smokey-black);
    color: var(--facet-white);
    border: none;
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.2rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--facet-transition-1);
    letter-spacing: 0.5px;
    text-transform: uppercase;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .price-apply-btn:hover {
    background: var(--facet-granite-gray);
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  }

  .price-apply-btn:active {
    transform: translateY(1px);
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  /* Active Filters Row */
  .active-facets-row {
    display: flex;
    justify-content: flex-end;
    padding: 15px 15px 0;
  }

  .active-facets__list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: flex-end;
  }

  .active-facet-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: var(--facet-cultured);
    border: 1px solid var(--facet-light-gray);
    text-decoration: none;
    color: var(--facet-smokey-black);
    font-size: 1.2rem;
    font-family: 'Cormorant Garamond', sans-serif;
    transition: all var(--facet-transition-1);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .active-facet-tag:hover {
    background: var(--facet-smokey-black);
    color: var(--facet-white);
    border-color: var(--facet-smokey-black);
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }

  .remove-x {
    font-size: 1.6rem;
    line-height: 1;
    font-weight: 300;
  }

  .clear-all-link {
    color: var(--facet-smokey-black);
    text-decoration: none;
    font-size: 1.2rem;
    font-family: 'Cormorant Garamond', sans-serif;
    font-weight: 500;
    transition: opacity var(--facet-transition-1);
    border-bottom: 1px solid var(--facet-smokey-black);
    padding-bottom: 2px;
  }

  .clear-all-link:hover {
    opacity: 0.6;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .facets-horizontal-right {
      justify-content: flex-start;
      padding: 15px;
    }

    .facets-controls-row {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
      width: 100%;
      justify-content: flex-start;
    }

    .facet-dropdown-wrapper {
      width: 100%;
    }

    .facet-dropdown {
      width: 100%;
      min-width: auto;
    }

    .active-facets-row {
      justify-content: flex-start;
      padding: 15px;
    }

    .active-facets__list {
      justify-content: flex-start;
    }
  }

  @media (max-width: 480px) {
    .price-inputs-inline {
      flex-wrap: wrap;
      gap: 8px;
    }

    .price-input-small {
      width: calc(50% - 4px);
    }

    .price-dash {
      display: none;
    }

    .price-apply-btn {
      width: 100%;
    }
  }
</style>

<script>
  // Auto-submit form when filters change
  document.getElementById('FacetFiltersForm').addEventListener('change', function(e) {
    if (e.target.type === 'checkbox') {
      this.submit();
    }
  });
</script>

{% schema %}
{
  "name": "Faceted filters",
  "settings": [],
  "presets": [
    {
      "name": "Faceted filters"
    }
  ]
}
{% endschema %}
