{% comment %}
  Faceted Filtering Section
  Provides filtering by availability, price, type, vendor, and variant options
  Uses Shopify's native filtering system
  Required for Theme Store compliance
{% endcomment %}

{%- liquid
  assign sort_by = collection.sort_by | default: collection.default_sort_by
  assign filter_count = 0
  for filter in collection.filters
    assign filter_count = filter_count | plus: filter.active_values.size
  endfor
-%}

{%- comment -%} Horizontal Filter Bar {%- endcomment -%}
<div class="facets-horizontal">
  <form class="facets-form" id="FacetFiltersForm">
    
    {%- comment -%} Filter Dropdowns {%- endcomment -%}
    <div class="facets-row">
      {%- for filter in collection.filters -%}
        {%- case filter.type -%}
          
          {%- comment -%} List Filters as Dropdowns {%- endcomment -%}
          {%- when 'list' -%}
            <div class="facet-dropdown-wrapper">
              <label class="facet-label">{{ filter.label }}</label>
              <select 
                name="{{ filter.values.first.param_name }}" 
                class="facet-dropdown"
                onchange="this.closest('form').submit()"
              >
                <option value="">All {{ filter.label }}</option>
                {%- for value in filter.values -%}
                  <option 
                    value="{{ value.value }}" 
                    {% if value.active %}selected{% endif %}
                    {% if value.count == 0 and value.active == false %}disabled{% endif %}
                  >
                    {{ value.label }} ({{ value.count }})
                  </option>
                {%- endfor -%}
              </select>
            </div>

          {%- comment -%} Price Range Filter {%- endcomment -%}
          {%- when 'price_range' -%}
            <div class="facet-dropdown-wrapper">
              <label class="facet-label">{{ filter.label }}</label>
              <div class="price-inputs-inline">
                <input
                  name="{{ filter.min_value.param_name }}"
                  type="number"
                  placeholder="Min"
                  min="0"
                  class="price-input-small"
                  {% if filter.min_value.value %}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                >
                <span class="price-dash">-</span>
                <input
                  name="{{ filter.max_value.param_name }}"
                  type="number"
                  placeholder="Max"
                  min="0"
                  class="price-input-small"
                  {% if filter.max_value.value %}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                >
                <button type="submit" class="price-apply-btn">Go</button>
              </div>
            </div>

        {%- endcase -%}
      {%- endfor -%}
    </div>

    {%- comment -%} Active Filters {%- endcomment -%}
    {% if filter_count > 0 %}
      <div class="active-facets-horizontal">
        <div class="active-facets__list">
          {%- for filter in collection.filters -%}
            {%- for value in filter.active_values -%}
              <a href="{{ value.url_to_remove }}" class="active-facet-tag">
                {{ value.label }} <span class="remove-x">Ã—</span>
              </a>
            {%- endfor -%}
          {%- endfor -%}
          <a href="{{ collection.url }}" class="clear-all-link">Clear all</a>
        </div>
      </div>
    {% endif %}
  </form>
</div>

<style>
  :root {
    --facet-smokey-black: hsl(0, 0%, 7%);
    --facet-granite-gray: hsl(0, 0%, 40%);
    --facet-spanish-gray: hsl(0, 0%, 60%);
    --facet-light-gray: hsl(0, 0%, 80%);
    --facet-cultured: hsl(220, 16%, 96%);
    --facet-white: hsl(0, 0%, 100%);
    --facet-transition-1: 0.25s ease;
  }

  /* Horizontal Filter Container */
  .facets-horizontal {
    width: 100%;
    padding: 25px 15px;
    border-bottom: 1px solid var(--facet-light-gray);
    background: var(--facet-white);
  }

  /* Filter Row - Horizontal Flex Layout */
  .facets-row {
    display: flex;
    flex-direction: row;
    gap: 20px;
    flex-wrap: wrap;
    align-items: flex-end;
    margin-bottom: 20px;
  }

  /* Individual Filter Dropdown Wrapper */
  .facet-dropdown-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-width: 180px;
  }

  /* Filter Labels */
  .facet-label {
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.4rem;
    font-weight: 500;
    color: var(--facet-smokey-black);
    letter-spacing: 0.5px;
  }

  /* Dropdown Selects */
  .facet-dropdown {
    padding: 10px 14px;
    border: 1px solid var(--facet-light-gray);
    border-radius: 0;
    background: var(--facet-white);
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.4rem;
    color: var(--facet-smokey-black);
    cursor: pointer;
    transition: var(--facet-transition-1);
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    padding-right: 35px;
  }

  .facet-dropdown:hover,
  .facet-dropdown:focus {
    border-color: var(--facet-smokey-black);
    outline: none;
  }

  /* Price Range Inline Inputs */
  .price-inputs-inline {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .price-input-small {
    width: 80px;
    padding: 10px 8px;
    border: 1px solid var(--facet-light-gray);
    border-radius: 0;
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.3rem;
    color: var(--facet-smokey-black);
    transition: var(--facet-transition-1);
  }

  .price-input-small:focus {
    outline: none;
    border-color: var(--facet-smokey-black);
  }

  .price-dash {
    color: var(--facet-granite-gray);
    font-size: 1.4rem;
  }

  .price-apply-btn {
    padding: 10px 18px;
    background: var(--facet-smokey-black);
    color: var(--facet-white);
    border: none;
    font-family: 'Cormorant Garamond', sans-serif;
    font-size: 1.3rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--facet-transition-1);
    letter-spacing: 0.5px;
  }

  .price-apply-btn:hover {
    background: var(--facet-granite-gray);
  }

  /* Active Filters - Horizontal */
  .active-facets-horizontal {
    padding-top: 15px;
    border-top: 1px solid var(--facet-light-gray);
  }

  .active-facets__list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }

  .active-facet-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    background: var(--facet-cultured);
    border: 1px solid var(--facet-light-gray);
    text-decoration: none;
    color: var(--facet-smokey-black);
    font-size: 1.3rem;
    font-family: 'Cormorant Garamond', sans-serif;
    transition: all var(--facet-transition-1);
  }

  .active-facet-tag:hover {
    background: var(--facet-smokey-black);
    color: var(--facet-white);
    border-color: var(--facet-smokey-black);
  }

  .remove-x {
    font-size: 1.6rem;
    line-height: 1;
    font-weight: 300;
  }

  .clear-all-link {
    color: var(--facet-smokey-black);
    text-decoration: underline;
    font-size: 1.3rem;
    font-family: 'Cormorant Garamond', sans-serif;
    font-weight: 400;
    transition: opacity var(--facet-transition-1);
  }

  .clear-all-link:hover {
    opacity: 0.6;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .facets-horizontal {
      padding: 20px 15px;
    }

    .facets-row {
      flex-direction: column;
      align-items: stretch;
      gap: 15px;
    }

    .facet-dropdown-wrapper {
      width: 100%;
    }

    .facet-dropdown {
      width: 100%;
    }

    .price-inputs-inline {
      flex-wrap: wrap;
    }

    .price-input-small {
      flex: 1;
      min-width: 70px;
    }
  }
</style>

<script>
  // Auto-submit form when filters change
  document.getElementById('FacetFiltersForm').addEventListener('change', function(e) {
    if (e.target.type === 'checkbox') {
      this.submit();
    }
  });
</script>

{% schema %}
{
  "name": "Faceted filters",
  "settings": [],
  "presets": [
    {
      "name": "Faceted filters"
    }
  ]
}
{% endschema %}
