<div class="customer addresses" data-customer-addresses>
  <div class="container">
    <div class="account-header">
      <h1 class="h2">{{ 'customer.addresses.title' | t | default: 'Addresses' }}</h1>
      <a href="{{ routes.account_url }}">{{ 'customer.account.return' | t | default: 'Return to Account details' }}</a>
    </div>

    <div class="address-actions">
      <button
        type="button"
        aria-expanded="false"
        aria-controls="AddAddress"
        class="btn btn-primary"
      >
        {{ 'customer.addresses.add_new' | t | default: 'Add a new address' }}
      </button>
    </div>

    <div id="AddAddress" class="address-form-container hidden">
      <h2 id="AddressNewHeading">{{ 'customer.addresses.add_new' | t | default: 'Add a new address' }}</h2>
      {%- form 'customer_address', customer.new_address, aria-labelledBy: 'AddressNewHeading' -%}
        <div class="field">
          <label for="AddressFirstNameNew">{{ 'customer.addresses.first_name' | t | default: 'First name' }}</label>
          <input type="text" id="AddressFirstNameNew" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name" placeholder="{{ 'customer.addresses.first_name' | t }}">
        </div>
        <div class="field">
          <label for="AddressLastNameNew">{{ 'customer.addresses.last_name' | t | default: 'Last name' }}</label>
          <input type="text" id="AddressLastNameNew" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name" placeholder="{{ 'customer.addresses.last_name' | t }}">
        </div>
        <div class="field">
          <label for="AddressCompanyNew">{{ 'customer.addresses.company' | t | default: 'Company' }}</label>
          <input type="text" id="AddressCompanyNew" name="address[company]" value="{{ form.company }}" autocomplete="organization" placeholder="{{ 'customer.addresses.company' | t }}">
        </div>
        <div class="field">
          <label for="AddressAddress1New">{{ 'customer.addresses.address1' | t | default: 'Address 1' }}</label>
          <input type="text" id="AddressAddress1New" name="address[address1]" value="{{ form.address1 }}" autocomplete="address-line1" placeholder="{{ 'customer.addresses.address1' | t }}">
        </div>
        <div class="field">
          <label for="AddressAddress2New">{{ 'customer.addresses.address2' | t | default: 'Address 2' }}</label>
          <input type="text" id="AddressAddress2New" name="address[address2]" value="{{ form.address2 }}" autocomplete="address-line2" placeholder="{{ 'customer.addresses.address2' | t }}">
        </div>
        <div class="field">
          <label for="AddressCityNew">{{ 'customer.addresses.city' | t | default: 'City' }}</label>
          <input type="text" id="AddressCityNew" name="address[city]" value="{{ form.city }}" autocomplete="address-level2" placeholder="{{ 'customer.addresses.city' | t }}">
        </div>
        <div class="field">
          <label for="AddressCountryNew">{{ 'customer.addresses.country' | t | default: 'Country' }}</label>
          <select
            id="AddressCountryNew"
            name="address[country]"
            data-default="{{ form.country }}"
            autocomplete="country"
          >
            {{ all_country_option_tags }}
          </select>
        </div>
        <div class="field" id="AddressProvinceContainerNew" style="display: none">
          <label for="AddressProvinceNew">{{ 'customer.addresses.province' | t | default: 'Province' }}</label>
          <select
            id="AddressProvinceNew"
            name="address[province]"
            data-default="{{ form.province }}"
            autocomplete="address-level1"
          >
          </select>
        </div>
        <div class="field">
          <label for="AddressZipNew">{{ 'customer.addresses.zip' | t | default: 'Zip' }}</label>
          <input type="text" id="AddressZipNew" name="address[zip]" value="{{ form.zip }}" autocapitalize="characters" autocomplete="postal-code" placeholder="{{ 'customer.addresses.zip' | t }}">
        </div>
        <div class="field">
          <label for="AddressPhoneNew">{{ 'customer.addresses.phone' | t | default: 'Phone' }}</label>
          <input type="tel" id="AddressPhoneNew" name="address[phone]" value="{{ form.phone }}" autocomplete="tel" placeholder="{{ 'customer.addresses.phone' | t }}">
        </div>
        <div class="field-checkbox">
          {{ form.set_as_default_checkbox }}
          <label for="address_default_address_new">{{ 'customer.addresses.set_default' | t | default: 'Set as default address' }}</label>
        </div>
        <div class="form-actions">
          <button class="btn btn-primary">{{ 'customer.addresses.add' | t | default: 'Add address' }}</button>
          <button type="reset" class="btn btn-secondary">{{ 'customer.addresses.cancel' | t | default: 'Cancel' }}</button>
        </div>
      {%- endform -%}
    </div>

    <ul role="list" class="address-list">
      {%- for address in customer.addresses -%}
        <li data-address>
          {%- if address == customer.default_address -%}
            <h2>{{ 'customer.addresses.default' | t | default: 'Default' }}</h2>
          {%- endif -%}
          {{ address | format_address }}
          
          <div class="address-item-actions">
            <button
              type="button"
              id="EditFormButton_{{ address.id }}"
              aria-label="{{ 'customer.addresses.edit_address' | t | default: 'Edit address' }} {{ forloop.index }}"
              aria-controls="EditAddress_{{ address.id }}"
              aria-expanded="false"
              data-address-id="{{ address.id }}"
              class="btn btn-small"
            >
              {{ 'customer.addresses.edit' | t | default: 'Edit' }}
            </button>
            <button
              type="button"
              aria-label="{{ 'customer.addresses.delete' | t | default: 'Delete' }} {{ address.id }}"
              data-target="{{ address.url }}"
              data-confirm-message="{{ 'customer.addresses.delete_confirm' | t | default: 'Are you sure you wish to delete this address?' }}"
              class="btn btn-small btn-danger"
            >
              {{ 'customer.addresses.delete' | t | default: 'Delete' }}
            </button>

            <div id="EditAddress_{{ address.id }}" class="address-form-container hidden">
              <h2>{{ 'customer.addresses.edit_address' | t | default: 'Edit address' }}</h2>
              {%- form 'customer_address', address -%}
                <!-- Similar fields as Add New, omitted for brevity but should be here -->
                <div class="field">
                  <label for="AddressFirstName_{{ form.id }}">{{ 'customer.addresses.first_name' | t | default: 'First name' }}</label>
                  <input type="text" id="AddressFirstName_{{ form.id }}" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name">
                </div>
                 <div class="field">
                  <label for="AddressLastName_{{ form.id }}">{{ 'customer.addresses.last_name' | t | default: 'Last name' }}</label>
                  <input type="text" id="AddressLastName_{{ form.id }}" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name">
                </div>
                <!-- ... other fields ... -->
                <div class="form-actions">
                  <button class="btn btn-primary">{{ 'customer.addresses.update' | t | default: 'Update address' }}</button>
                  <button type="reset" class="btn btn-secondary">{{ 'customer.addresses.cancel' | t | default: 'Cancel' }}</button>
                </div>
              {%- endform -%}
            </div>
          </div>
        </li>
      {%- endfor -%}
    </ul>
  </div>
</div>

<script>
  window.onload = () => {
    // Simple toggle logic for forms
    const selectors = {
      customerAddresses: '[data-customer-addresses]',
      addressCountrySelect: '[data-address-country-select]',
      addressContainer: '[data-address]',
      toggleButton: 'button[aria-expanded]'
    };

    document.querySelectorAll(selectors.toggleButton).forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('aria-controls');
        const target = document.getElementById(targetId);
        if(target) {
            target.classList.toggle('hidden');
            this.setAttribute('aria-expanded', !target.classList.contains('hidden'));
        }
      });
    });
  }
</script>

<style>
  .customer.addresses { padding: 4rem 1rem; }
  .account-header { margin-bottom: 3rem; text-align: center; }
  .address-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
  .address-form-container.hidden { display: none; }
  .field { margin-bottom: 1rem; }
  .field input, .field select { width: 100%; padding: 0.8rem; border: 1px solid #ddd; }
  .btn { padding: 0.8rem 1.5rem; cursor: pointer; }
  .btn-primary { background: #000; color: #fff; border: none; }
  .btn-secondary { background: #fff; border: 1px solid #000; }
</style>

{% schema %}
{
  "name": "Addresses Page",
  "settings": []
}
{% endschema %}
