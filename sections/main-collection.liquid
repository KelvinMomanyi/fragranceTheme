{%- liquid
  if section.settings.selected_collection != blank
    assign current_collection = collections[section.settings.selected_collection]
  else
    assign current_collection = collection
  endif
-%}

<div class="container color-scheme-{{ section.settings.color_scheme | default: '1' }}" style="padding-top:25px;">
  {%- comment -%} Collection Hero with Image (Required) {%- endcomment -%}
  {% if current_collection.image %}
    <div class="collection-hero">
      <img 
        src="{{ current_collection.image | image_url: width: 1600 }}" 
        alt="{{ current_collection.image.alt | escape | default: current_collection.title }}"
        class="collection-hero-image"
        loading="eager"
        width="1600"
        height="400"
      >
      <div class="collection-hero-overlay">
        <h1 class="collection-hero-title">{{ current_collection.title }}</h1>
      </div>
    </div>
  {% endif %}

  <section class="section shop" id="shop" aria-label="shop">
    <div class="container">
      
      <div class="title-wrapper" style="display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 20px;">
        {% unless current_collection.image %}
          <h1 class="h2 section-title">{{ current_collection.title }}</h1>
        {% endunless %}
        {% render 'faceted-filters' %}
      </div>
      
      {%- comment -%} Collection Description (Required) {%- endcomment -%}
      {% if current_collection.description != blank %}
        <div class="collection-description rte">
          {{ current_collection.description }}
        </div>
      {% endif %}
            
            <div class="collection-container">
                <div class="collection">
                    {% if section.settings.selected_collection != blank %}
                        {% assign selected_collection = collections[section.settings.selected_collection] %}
                        {% for product in selected_collection.products %}
                          <li class="decoration">
                            <div class="product-card">
                              <a href="{{ product.url }}" class="card-banner img-holder has-before" style="--width: 300; --height: 300;">
                                {% if product.featured_image %}
                                  <img src="{{ product.featured_image | img_url: 'large' }}" 
                                    alt="{{ product.featured_image.alt | escape }}" 
                                    class="img-cover" 
                                    width="300" 
                                    height="300" 
                                    loading="lazy">
                                {% else %}
                                 <img src="default-image.jpg" 
                                    alt="No image available" 
                                    class="img-cover" 
                                     width="300" 
                                     height="300" 
                                     loading="lazy">
                                {% endif %}
                             <ul class="card-action-list">
                              <li>
                               <button class="card-action-btn" aria-label="add to cart" title="add to cart">
                                 <ion-icon name="add-outline" aria-hidden="true"></ion-icon>
                               </button>
                             </li>
                             <li>
                             <button class="card-action-btn" aria-label="view cart" title="view cart">
                             <ion-icon name="bag-handle-outline" aria-hidden="true"></ion-icon>
                         </button>
                       </li>
                       <li>
                         <button class="card-action-btn" aria-label="add to wishlist" title="add to wishlist">
                           <ion-icon name="heart-outline" aria-hidden="true"></ion-icon>
                         </button>
                       </li>
                     </ul>
                     {% if product.compare_at_price > product.price %}
                     <ul class="badge-list">
                       <li>
                         <div class="badge orange">Sale</div>
                       </li>
                       <li>
                         <div class="badge cyan">
                           10%
                         </div>
                       </li>
                     </ul>
                     {% endif %}
                   </a>
                        <div class="card-content">
                           <h3 class="h3">
                             <a href="{{ product.url }}" class="card-title">{{ product.title }}</a>
                           </h3>
                            <div class="card-price">
                             {% if product.compare_at_price > product.price %}
                               <del class="del">{{ product.compare_at_price | money }}</del>
                            {% endif %}
                            {% if product.price_varies %}
                              <span class="price-from">From </span>
                            {% endif %}
                               <data class="price" value="{{ product.price }}">{{ product.price | money }}</data>
                             </div>
                            {%- comment -%} Unit Pricing (Required) {%- endcomment -%}
                            {% assign first_variant = product.selected_or_first_available_variant %}
                            {% if first_variant.unit_price_measurement %}
                              <div class="unit-price">
                                {{ first_variant.unit_price | money }}/{{ first_variant.unit_price_measurement.reference_value }}{{ first_variant.unit_price_measurement.reference_unit }}
                              </div>
                            {% endif %}
                            </div>
                           </div>
                          </li>
                        {% endfor %}
                    {% else %}
                        {% for product in collection.products   %}
                          <li class="decoration">
                            <div class="product-card">
                              <a href="{{ product.url }}" class="card-banner img-holder has-before" style="--width: 300; --height: 300;">
                                {% if product.featured_image %}
                                  <img src="{{ product.featured_image | img_url: 'large' }}" 
                                    alt="{{ product.featured_image.alt | escape }}" 
                                    class="img-cover" 
                                    width="300" 
                                    height="300" 
                                    loading="lazy">
                                {% else %}
                                 <img src="default-image.jpg" 
                                    alt="No image available" 
                                    class="img-cover" 
                                     width="300" 
                                     height="300" 
                                     loading="lazy">
                                {% endif %}
                             <ul class="card-action-list">
                              <li>
                               <button class="card-action-btn" aria-label="add to cart" title="add to cart">
                                 <ion-icon name="add-outline" aria-hidden="true"></ion-icon>
                               </button>
                             </li>
                             <li>
                             <button class="card-action-btn" aria-label="view cart" title="view cart">
                             <ion-icon name="bag-handle-outline" aria-hidden="true"></ion-icon>
                         </button>
                       </li>
                       <li>
                         <button class="card-action-btn" aria-label="add to wishlist" title="add to wishlist">
                           <ion-icon name="heart-outline" aria-hidden="true"></ion-icon>
                         </button>
                       </li>
                     </ul>
                     {% if product.compare_at_price > product.price %}
                     <ul class="badge-list">
                       <li>
                         <div class="badge orange">Sale</div>
                       </li>
                       <li>
                         <div class="badge cyan">
                           10%
                         </div>
                       </li>
                     </ul>
                     {% endif %}
                   </a>
                        <div class="card-content">
                           <h3 class="h3">
                             <a href="{{ product.url }}" class="card-title">{{ product.title }}</a>
                           </h3>
                            <div class="card-price">
                             {% if product.compare_at_price > product.price %}
                               <del class="del">{{ product.compare_at_price | money }}</del>
                            {% endif %}
                            {% if product.price_varies %}
                              <span class="price-from">From </span>
                            {% endif %}
                               <data class="price" value="{{ product.price }}">{{ product.price | money }}</data>
                             </div>
                            {%- comment -%} Unit Pricing (Required) {%- endcomment -%}
                            {% assign first_variant = product.selected_or_first_available_variant %}
                            {% if first_variant.unit_price_measurement %}
                              <div class="unit-price">
                                {{ first_variant.unit_price | money }}/{{ first_variant.unit_price_measurement.reference_value }}{{ first_variant.unit_price_measurement.reference_unit }}
                              </div>
                            {% endif %}
                            </div>
                           </div>
                          </li>
                        {% endfor %}
                    {% endif %}
                       
            
              </div>
              
              {%- comment -%} Empty Collection Message (Required) {%- endcomment -%}
              {% if current_collection.products.size == 0 %}
                <div class="collection-empty">
                  <p>{{ 'collections.general.no_matches' | t | default: 'Sorry, there are no products in this collection.' }}</p>
                  <a href="{{ routes.all_products_collection_url }}" class="btn btn-primary">
                    {{ 'collections.general.browse_all' | t | default: 'Browse all products' }}
                  </a>
                </div>
              {% endif %}
            </div>
            
            {%- comment -%} Pagination (Required) {%- endcomment -%}
            {% paginate current_collection.products by 24 %}
              {% if paginate.pages > 1 %}
                <nav class="pagination" aria-label="Pagination">
                  <ul class="pagination-list">
                    {% if paginate.previous %}
                      <li>
                        <a href="{{ paginate.previous.url }}" class="pagination-link pagination-prev" aria-label="Previous page">
                          &larr; {{ 'general.pagination.previous' | t | default: 'Previous' }}
                        </a>
                      </li>
                    {% endif %}
                    
                    {% for part in paginate.parts %}
                      {% if part.is_link %}
                        <li>
                          <a href="{{ part.url }}" class="pagination-link" aria-label="Page {{ part.title }}">
                            {{ part.title }}
                          </a>
                        </li>
                      {% else %}
                        {% if part.title == paginate.current_page %}
                          <li>
                            <span class="pagination-link pagination-current" aria-current="page">
                              {{ part.title }}
                            </span>
                          </li>
                        {% else %}
                          <li>
                            <span class="pagination-link pagination-ellipsis">{{ part.title }}</span>
                          </li>
                        {% endif %}
                      {% endif %}
                    {% endfor %}
                    
                    {% if paginate.next %}
                      <li>
                        <a href="{{ paginate.next.url }}" class="pagination-link pagination-next" aria-label="Next page">
                          {{ 'general.pagination.next' | t | default: 'Next' }} &rarr;
                        </a>
                      </li>
                    {% endif %}
                  </ul>
                </nav>
              {% endif %}
            {% endpaginate %}
            
          </div>
      </section> 
</div>  
 <style>
    /* Collection Hero Styles */
    .collection-hero {
      position: relative;
      width: 100%;
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .collection-hero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .collection-hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 60%);
      display: flex;
      align-items: flex-end;
      padding: 30px;
    }
    
    .collection-hero-title {
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .collection-description {
      margin-bottom: 30px;
      line-height: 1.7;
      color: #555;
    }
    
    /* Empty Collection */
    .collection-empty {
      text-align: center;
      padding: 60px 20px;
      background: #f8f9fa;
      border-radius: 12px;
      margin: 40px 0;
    }
    
    .collection-empty p {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 20px;
    }
    
    .collection-empty .btn {
      display: inline-block;
      padding: 12px 25px;
      background: #111;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.3s;
    }
    
    .collection-empty .btn:hover {
      background: #333;
    }
    
    /* Pagination */
    .pagination {
      margin: 40px 0;
      display: flex;
      justify-content: center;
    }
    
    .pagination-list {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .pagination-link {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      height: 40px;
      padding: 0 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .pagination-link:hover {
      background: #f5f5f5;
      border-color: #333;
    }
    
    .pagination-current {
      background: #111;
      color: white;
      border-color: #111;
    }
    
    .pagination-ellipsis {
      border: none;
    }
    
    .pagination-prev,
    .pagination-next {
      font-weight: 500;
    }
    
    .hero-small {
        min-height: 30vh;
    }
    
    .collection-container {
        box-sizing: border-box;
    }

    .collection {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    @media (min-width: 1200px) {
        .collection {
            grid-template-columns: repeat(5, 1fr);
        }
    }
    
    @media (min-width: 900px) and (max-width: 1199px) {
        .collection {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    
    @media (min-width: 750px) and (max-width: 899px) {
        .collection {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (min-width: 575px) and (max-width:750px) {
        .collection {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .card {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        opacity: 0;
        transform: translateY(50px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }
    
    .card.in-view {
        opacity: 1;
        transform: translateY(0);
    }
    
    .card img {
        width: 100%;
        height: auto;
    }
    
    .card-content {
        padding: 20px;
    }
    
    .card h3 {
        margin: 0 0 10px;
    }
    
    .card p {
        margin: 0;
        color: #666;
    }

    /* New Styles for Title Wrapper and Filter Controls */
    .title-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        gap: 1.5rem;
        flex-wrap: wrap;
    }

    .filter-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        z-index: 5;
    }

    .filter-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
        font-size: 0.95rem;
    }

    .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .filter-btn ion-icon {
        font-size: 1.1rem;
    }

    @media (max-width: 768px) {
        .title-wrapper {
            flex-direction: column;
            align-items: flex-start;
        }

        .filter-controls {
            width: 100%;
            justify-content: flex-start;
        }

        .filter-btn {
            flex: 1;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .filter-controls {
            flex-direction: column;
            width: 100%;
        }

        .filter-btn {
            width: 100%;
        }
    }
</style>     
<script>
    function fetchCart() {
      fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
          updateCartUI(cart);
        })
        .catch(error => console.error('Error-fetching cart:', error));
    }

    const currencySymbol = "{{ shop.currency | escape }}"; 
    function updateCartUI(cart) {
      var cartContent = document.getElementById('cart-content');
      cartContent.innerHTML = '';
      
      if (cart.item_count > 0) {
        var cartHTML = `
        <div style="display: flex; flex-direction: column;">
          <h1>Cart</h1>
          <form action="/cart" method="post" novalidate>`;
        let subtotal = 0;
        cart.items.forEach(function(item, index) {
          const itemPrice = item.price / 100;
          const initialTotalPrice = itemPrice * item.quantity;
          subtotal += initialTotalPrice;
          const safeItemId = `item_${item.key.replace(/[^a-zA-Z0-9_-]/g, '')}`;

          cartHTML += `
                      <div style="display:flex;"  id="${safeItemId}">
                          <div style="flex:1; display:flex; align-items:center; justify-content:center;">
                          <a href="${item.url}">
                              <img src="${item.image}" alt="${item.title}" class="img-cover" width="480" height="640" loading="lazy">
                            </a>
                          </div>
                          <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column;" >
                            <td>
                              <a href="${item.url}">${item.product_title}</a>
                                ${item.price}
                              <a href="#" class="remove-item" data-line="${index + 1}" data-key="${item.key}" style="color: red;">Remove</a>
                              
                            </td>
                            <td id="price_${item.key}">
                              ${currencySymbol}${initialTotalPrice.toFixed(2)}
                            </td>
                            <div>
                                <p>Unit Price: ${currencySymbol}${itemPrice.toFixed(2)}</p>
                                <p id="line_price_${item.key}">Total: ${currencySymbol}${initialTotalPrice.toFixed(2)}</p>
                            </div>
                            <td>
                              <input type="number" name="updates[]" id="updates_${item.key}" value="${item.quantity}" min="0">
                            </td>
                            <td>
                              {% if item.original_line_price != item.line_price %}{{ item.original_line_price | money }}{% endif %}
                              {{ item.line_price | money }}
                              {% for discount in item.discounts %}{{ discount.title }}{% endfor %}
                          </td>
                          <div class="quantity-selector">
                            <button type="button" class="decrement" id="decrement_${item.key}">-</button>
                            <span id="quantity_${item.key}">${item.quantity}</span>
                            <button type="button" class="increment" id="increment_${item.key}">+</button>
                          </div> 
                          </div>
                  </div>
          `;
        });
    
        cartHTML += `
          <div>
            <p id="subtotal">Subtotal: ${currencySymbol}${subtotal.toFixed(2)}</p>
            <button type="submit" name="update">Update</button>
            <button type="submit" name="checkout" class="btn btn-primary">Checkout</button>
          </div>
        </form>
      </div>`; 

      cartContent.innerHTML = cartHTML;

    cart.items.forEach(function(item, index) {
      const decrementButton = document.getElementById(`decrement_${item.key}`);
      const incrementButton = document.getElementById(`increment_${item.key}`);
      const quantityDisplay = document.getElementById(`quantity_${item.key}`);
      const quantityInput = document.getElementById(`updates_${item.key}`);
      const linePriceDisplay = document.getElementById(`line_price_${item.key}`);
      const subtotalDisplay = document.getElementById('subtotal');
      const safeItemId = `item_${item.key.replace(/[^a-zA-Z0-9_-]/g, '')}`;

      function updatePriceAndQuantity(newQuantity) {
        const newLinePrice = (item.price * newQuantity) / 100;
        quantityDisplay.textContent = newQuantity;
        quantityInput.value = newQuantity;
        linePriceDisplay.textContent = `Total: ${currencySymbol}${newLinePrice.toFixed(2)}`;

        subtotal = subtotal - (item.price * item.quantity) / 100 + newLinePrice;
        subtotalDisplay.textContent = `Subtotal: ${currencySymbol}${subtotal.toFixed(2)}`;

        item.quantity = newQuantity;
      }

      decrementButton.addEventListener('click', function() {
        let currentQuantity = parseInt(quantityInput.value, 10);
        if (currentQuantity > 1) {
          currentQuantity--;
          updatePriceAndQuantity(currentQuantity);
        }
      });

      incrementButton.addEventListener('click', function() {
        let currentQuantity = parseInt(quantityInput.value, 10);
        currentQuantity++;
        updatePriceAndQuantity(currentQuantity);
      });

      const removeButton = document.querySelector(`.remove-item[data-key="${item.key}"]`);
      
      removeButton.addEventListener('click', function(e) {
        e.preventDefault();
        removeCartItem(safeItemId, index +1);
      });
    });
      } else {
        cartContent.innerHTML = '<h2>Cart</h2><p>Cart is empty</p>';
      }

      function removeCartItem(safeItemId, line) {
          console.log(`Attempting to remove item with ID: ${safeItemId}`);
          const itemElement = document.getElementById(safeItemId);
          if (itemElement) {
            fetch(`/cart/change.js`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
              },
              body: JSON.stringify({
                line: line,
                quantity: 0
              })
            })
            .then(response => response.json())
            .then(updatedCart => {
              itemElement.remove();
              updateSubtotal(updatedCart);
            })
            .catch(error => {
              console.error('Error removing item from cart:', error);
            });
          } else {
            console.error(`Element with ID ${safeItemId} not found.`);
          }
      }
      
      function updateSubtotal(updatedCart) {
        let subtotal = 0;
        updatedCart.items.forEach(item => {
          subtotal += (item.price * item.quantity) / 100;
        });
        document.getElementById('subtotal').textContent = `Subtotal: ${currencySymbol}${subtotal.toFixed(2)}`;
      }
    }

    function submitAddToCartForm(formElement) {
      let formData = new FormData(formElement);
      var myModal2 = document.getElementById('myModal2');
      var loader = myModal2.querySelector('#loader');
      var cartContent = myModal2.querySelector('#cart-content');
    
      myModal2.style.display = 'block';
      loader.style.display = 'block';
      cartContent.style.display = 'none';
    
      fetch(window.Shopify.routes.root + 'cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {     
        openCart(); 
        fetchCart();
        setTimeout(function() {
          loader.style.display = 'none';
          cartContent.style.display = 'block';
        }, 100); 
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    
      return false;
    }
</script>
      
 {% schema %}
      {
        "name": "main-collection",
        "settings": [
            {
              "type": "select",
              "id": "color_scheme",
              "label": "Color scheme",
              "options": [
                { "value": "1", "label": "Scheme 1" },
                { "value": "2", "label": "Scheme 2" },
                { "value": "3", "label": "Scheme 3" },
                { "value": "4", "label": "Scheme 4" },
                { "value": "5", "label": "Scheme 5" }
              ],
              "default": "1"
            },
            {
             "type": "collection",
             "id": "selected_collection",
             "label": "Select Collection"
           }
        ],
        "blocks": [],
        "presets": [
          {
            "name": "main-collection"
          }
        ]
      }
 {% endschema %}