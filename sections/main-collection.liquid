{%- liquid
  if section.settings.selected_collection != blank
    assign current_collection = collections[section.settings.selected_collection]
  else
    assign current_collection = collection
  endif
-%}

{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-facets.css' | asset_url | stylesheet_tag }}
<script src="{{ 'facets.js' | asset_url }}" type="module"></script>
<script src="{{ 'menu-drawer.js' | asset_url }}" defer="defer"></script>

<div class="container color-scheme-{{ section.settings.color_scheme }}" style="{% render 'color-scheme-styles', scheme: section.settings.color_scheme %} padding-top:25px;">
  {%- comment -%} Collection Hero with Image {%- endcomment -%}
  {% if current_collection.image %}
    <div class="collection-hero">
      <img
        src="{{ current_collection.image | image_url: width: 1600 }}"
        srcset="{{ current_collection.image | image_url: width: 750 }} 750w,
                {{ current_collection.image | image_url: width: 1100 }} 1100w,
                {{ current_collection.image | image_url: width: 1500 }} 1500w,
                {{ current_collection.image | image_url: width: 1780 }} 1780w,
                {{ current_collection.image | image_url: width: 2000 }} 2000w"
        sizes="100vw"
        alt="{{ current_collection.image.alt | escape | default: current_collection.title }}"
        class="collection-hero-image"
        loading="eager"
        width="1600"
        height="400"
      >
      <div class="collection-hero-overlay">
        <h1 class="collection-hero-title">{{ current_collection.title }}</h1>
      </div>
    </div>
  {% endif %}

  <section class="section shop" id="shop" aria-label="shop">
    <div class="title-wrapper">
      {% unless current_collection.image %}
        <h1 class="h2 section-title">{{ current_collection.title }}</h1>
      {% endunless %}
    </div>

    {%- comment -%} Collection Description {%- endcomment -%}
    {% if current_collection.description != blank %}
      <div class="collection-description rte">
        {{ current_collection.description }}
      </div>
    {% endif %}

    <div class="section-{{ section.id }}-padding">
      {% paginate current_collection.products by 24 %}
        
        <div class="{% if section.settings.filter_type == 'vertical' %}facets-vertical{% endif %}">
          {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
            <aside
              aria-labelledby="verticalTitle"
              class="facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}"
              id="main-collection-filters"
              data-id="{{ section.id }}"
            >
              {% render 'facets',
                results: current_collection,
                enable_filtering: section.settings.enable_filtering,
                enable_sorting: section.settings.enable_sorting,
                filter_type: section.settings.filter_type,
                paginate: paginate,
                section_id: section.id
              %}
            </aside>
          {%- endif -%}

          <div class="product-grid-container" id="ProductGridContainer">
            {%- if current_collection.products.size == 0 -%}
              <div class="collection collection--empty" id="product-grid" data-id="{{ section.id }}">
                <div class="loading-overlay gradient"></div>
                <div class="title-wrapper center">
                  <h2 class="title title--primary">
                    {{ 'sections.collection_template.empty' | t -}}
                    <br>
                    {{
                      'sections.collection_template.use_fewer_filters_html'
                      | t: link: current_collection.url, class: 'underlined-link link'
                    }}
                  </h2>
                </div>
              </div>
            {%- else -%}
              <div class="collection">
                <div class="loading-overlay gradient"></div>
                
                <!-- Strategic product count location (shows once) -->
                <div class="product-count strategic-product-count" role="status">
                  <h2 class="product-count__text text-body">
                    <span>
                      {%- if current_collection.results_count -%}
                        {{
                          'templates.search.results_with_count'
                          | t: terms: current_collection.terms, count: current_collection.results_count
                        }}
                      {%- elsif current_collection.products_count == current_collection.all_products_count -%}
                        {{ 'products.facets.product_count_simple' | t: count: current_collection.products_count }}
                      {%- else -%}
                        {{
                          'products.facets.product_count'
                          | t: product_count: current_collection.products_count, count: current_collection.all_products_count
                        }}
                      {%- endif -%}
                    </span>
                  </h2>
                </div>

                <ul
                  id="product-grid"
                  data-id="{{ section.id }}"
                  class="collection-grid"
                  style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; list-style: none; padding: 0;"
                >
                  {%- for product in current_collection.products -%}
                    <li class="grid__item decoration">
                       <div class="product-card">
                        <a
                          href="{{ product.url }}"
                          class="card-banner img-holder has-before"
                          style="--width: 300; --height: 300;"
                        >
                          {% if product.featured_image %}
                            <img
                              src="{{ product.featured_image | image_url: width: 600 }}"
                              srcset="{{ product.featured_image | image_url: width: 300 }} 300w,
                                      {{ product.featured_image | image_url: width: 450 }} 450w,
                                      {{ product.featured_image | image_url: width: 600 }} 600w"
                              sizes="(max-width: 480px) 100vw, (max-width: 768px) 50vw, 300px"
                              alt="{{ product.featured_image.alt | escape }}"
                              class="img-cover"
                              width="300"
                              height="300"
                              loading="lazy"
                            >
                          {% else %}
                            {{ 'product-1' | placeholder_svg_tag: 'img-cover' }}
                          {% endif %}
                          <ul class="card-action-list">
                            <li>
                              <button class="card-action-btn" aria-label="add to cart" title="add to cart">
                                {% render 'icon-velour', icon: 'add' %}
                              </button>
                            </li>
                            <li>
                               <form action="/cart/add" method="post" enctype="multipart/form-data" class="add-to-cart-form">
                                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                                  <button type="submit" class="card-action-btn" aria-label="add to cart">
                                    {% render 'icon-velour', icon: 'bag-handle' %}
                                  </button>
                                </form>
                            </li>
                          </ul>
                          {% if product.compare_at_price > product.price %}
                            <ul class="badge-list">
                              <li>
                                <div class="badge orange">Sale</div>
                              </li>
                              <li>
                                <div class="badge cyan">{%- assign savings = product.compare_at_price | minus: product.price -%}{%- assign savings_percent = savings | times: 100 | divided_by: product.compare_at_price -%}{{ savings_percent }}%</div>
                              </li>
                            </ul>
                          {% endif %}
                        </a>
                        <div class="card-content">
                          <h3 class="h3">
                            <a href="{{ product.url }}" class="card-title">{{ product.title }}</a>
                          </h3>
                          <div class="card-price">
                            {% if product.compare_at_price > product.price %}
                              <del class="del">{{ product.compare_at_price | money }}</del>
                            {% endif %}
                            {% if product.price_varies %}
                              <span class="price-from">From </span>
                            {% endif %}
                            <data class="price" value="{{ product.price }}">{{ product.price | money }}</data>
                          </div>
                           {% assign first_variant = product.selected_or_first_available_variant %}
                             {% if first_variant.unit_price_measurement %}
                               <div class="unit-price">
                                 {{ first_variant.unit_price | money }}/{{ first_variant.unit_price_measurement.reference_value }}{{ first_variant.unit_price_measurement.reference_unit }}
                               </div>
                             {% endif %}
                        </div>
                      </div>
                    </li>
                  {%- endfor -%}
                </ul>

                {%- if paginate.pages > 1 -%}
                   {% render 'pagination', paginate: paginate, anchor: '' %}
                {%- endif -%}
              </div>
            {%- endif -%}
          </div>
        </div>
      {% endpaginate %}
    </div>
  </section>
</div>

<style>
  .collection-hero {
    position: relative;
    width: 100%;
    height: 300px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 30px;
  }

  .collection-hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .collection-hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, transparent 60%);
    display: flex;
    align-items: flex-end;
    padding: 30px;
  }

  .collection-hero-title {
    color: white;
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  .collection-description {
    margin-bottom: 30px;
    line-height: 1.7;
    color: #555;
  }

  .collection-empty {
    text-align: center;
    padding: 60px 20px;
    background: #f8f9fa;
    border-radius: 12px;
    margin: 40px 0;
  }

  .collection-empty p {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 20px;
  }



  .card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      opacity: 0;
      transform: translateY(50px);
      transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .card.in-view {
      opacity: 1;
      transform: translateY(0);
  }

  .card img {
      width: 100%;
      height: auto;
  }

  .card-content {
      padding: 20px;
  }

  .card h3 {
      margin: 0 0 10px;
  }

  .card p {
      margin: 0;
      color: #666;
  }

  .title-wrapper {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      gap: 1.5rem;
      flex-wrap: wrap;
  }

  @media (max-width: 768px) {
      .title-wrapper {
          flex-direction: column;
          align-items: flex-start;
      }
  }

.strategic-product-count {
  margin: 24px 0 16px 0;
  font-size: 1.25rem;
  font-weight: 500;
}

  @media screen and (min-width: 750px) {
    .facets-vertical {
      display: flex;
      gap: 2rem;
    }

    .facets-vertical .facets-wrapper {
      flex: 0 0 280px;
      max-width: 280px;
    }

    .facets-vertical .product-grid-container {
      flex: 1;
      min-width: 0;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const addToCartForms = document.querySelectorAll('.add-to-cart-form');
  
  addToCartForms.forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      
      fetch('/cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        fetch('/cart.js')
          .then(response => response.json())
          .then(cart => {
            const cartCountElements = document.querySelectorAll('.cart-count-bubble, [data-cart-count]');
            cartCountElements.forEach(el => {
              el.textContent = cart.item_count;
            });
            
            const cartEvent = new CustomEvent('cart:updated', { detail: cart });
            document.dispatchEvent(cartEvent);
          });
      })
      .catch(error => {
        console.error('Error adding to cart:', error);
      });
    });
  });
});
</script>

 {% schema %}
      {
        "name": "Main collection",
        "settings": [
            {
              "type": "color_scheme","id": "color_scheme","label": "Color scheme","default": "scheme-1"
            },
            {
             "type": "collection",
             "id": "selected_collection",
             "label": "Select Collection"
           },
            {
              "type": "checkbox",
              "id": "enable_filtering",
              "default": true,
              "label": "Enable filtering"
            },
            {
              "type": "select",
              "id": "filter_type",
              "options": [
                {
                  "value": "horizontal",
                  "label": "Horizontal"
                },
                {
                  "value": "vertical",
                  "label": "Vertical"
                },
                {
                  "value": "drawer",
                  "label": "Drawer"
                }
              ],
              "default": "horizontal",
              "label": "Filter type"
            },
            {
              "type": "checkbox",
              "id": "enable_sorting",
              "default": true,
              "label": "Enable sorting"
            }
        ],
        "blocks": [],
        "presets": [
          {
            "name": "Main collection"
          }
        ]
      }
 {% endschema %}
