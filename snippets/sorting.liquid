{%- doc -%}
  Renders the sorting component.

  @param {object} results - The results of the search
  @param {string} sort_by - The current sort by
  @param {string} filter_style - The filter style
  @param {string} [suffix] - Used on `form` attributes to connect inputs to a form[id]
  @param {string} [sort_position] - Used in a data-testID selector for automated testing
  @param {boolean} should_use_select_on_mobile - Whether to use a select element for the sorting component on mobile
  @param {string} section_id - The section ID
{%- enddoc -%}

<sorting-filter-component
  class="sorting-filter{% if filter_style == 'horizontal' %} sorting-filter__horizontal{% endif %}"
  on:change="/updateFilterAndSorting"
  on:keydown="/handleKeyDown"
  {% if sort_position != blank %}
    data-testid="sorting-filter-component-{{ sort_position }}"
  {% endif %}
  data-should-use-select-on-mobile="{{ should_use_select_on_mobile }}"
>
  {% liquid
    assign default_sort_by = results.default_sort_by
    for option in results.sort_options
      if option.value == sort_by
        assign status = option.name
      endif
    endfor
  %}

  <div class="sorting-filter__container {% if should_use_select_on_mobile %} desktop:hidden {% else %} hidden {% endif %}">
    <label
      for="sort-select-{{ section_id }}"
      class="facets__label"
    >
      {{- 'products.facets.sort_by_label' | t -}}
    </label>
    <div class="sorting-filter__select-wrapper">
      <select
        id="sort-select-{{ section_id }}"
        name="sort_by"
        class="sorting-filter__select"
        {% if should_use_select_on_mobile == false %}
          disabled
        {% endif %}
      >
        {% for option in results.sort_options %}
          <option
            value="{{ option.value }}"
            {% if option.value == sort_by %}
              selected
            {% endif %}
          >
            {{ option.name }}
          </option>
        {% endfor %}
      </select>
      <span class="svg-wrapper icon-caret">
        {% render 'icon-fragrance', icon: 'chevron-down' %}
      </span>
    </div>
  </div>

  <details
    ref="details"
    id="Sorting-{{ section_id }}"
    data-default-sort-by="{{ default_sort_by }}"
    class="facets__panel {% if should_use_select_on_mobile %} mobile:hidden {% endif %}"
    on:toggle="/handleToggle"
  >
    <summary
      class="facets__summary"
      role="button"
      aria-expanded="false"
      aria-controls="sorting-options-{{ section_id }}"
      ref="summary"
    >
      <span
        class="facets__label"
        id="sort-label-{{ section_id }}"
      >
        {{- 'products.facets.sort_by_label' | t -}}
      </span>
      <span
        class="facets__status h6 desktop:hidden"
      >
        {{- status -}}
      </span>
      <span class="svg-wrapper icon-caret icon-animated">
        {% render 'icon-fragrance', icon: 'chevron-down' %}
      </span>
    </summary>
    <div
      id="sorting-options-{{ section_id }}"
      class="sorting-filter__options"
      role="listbox"
      aria-labelledby="sort-label-{{ section_id }}"
      ref="listbox"
    >
      <div class="sorting-filter__options-inner">
        {% for option in results.sort_options %}
          <label
            for="sort-option-{{ option.value }}-{{ section_id }}"
          >
            <div
              class="sorting-filter__option"
              role="option"
              aria-selected="{% if option.value == sort_by %}true{% else %}false{% endif %}"
              tabindex="{% if option.value == sort_by %}0{% else %}-1{% endif %}"
            >
              <input
                type="radio"
                name="sort_by"
                id="sort-option-{{ option.value }}-{{ section_id }}"
                {% if suffix != blank %}
                  form="FacetFiltersForm--{{ section_id }}-{{ suffix }}"
                {% endif %}
                value="{{ option.value }}"
                class="sorting-filter__input"
                data-option-name="{{ option.name }}"
                {% if option.value == sort_by %}
                  checked
                {% endif %}
                aria-hidden="true"
              >
              <span class="svg-wrapper icon-checkmark sorting-filter__checkmark">
                {% render 'icon-fragrance', icon: 'checkmark' %}
              </span>
              <span class="sorting-filter__label">{{ option.name }}</span>
            </div>
          </label>
        {% endfor %}
      </div>
    </div>
  </details>
</sorting-filter-component>

{% stylesheet %}
  /* ---- Sorting (complements component-facets.css) ---- */

  .sorting-filter__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0;
    position: relative;
  }

  .sorting-filter__container .facets__label {
    font-size: 15px;
    font-weight: 500;
  }

  .sorting-filter {
    z-index: 100;
    position: relative;
  }

  .sorting-filter__horizontal {
    margin-left: auto;
  }

  .sorting-filter__options {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    color: var(--color-text, #333);
    z-index: 1002;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: var(--color-background, #fff);
    border-radius: 12px;
    width: max-content;
    min-width: 200px;
    min-height: 0;
    transition: grid-template-rows 0.25s ease, opacity 0.25s ease;
  }

  details[open] .sorting-filter__options {
    opacity: 1;
    grid-template-rows: 1fr;
  }

  .sorting-filter__options-inner {
    display: flex;
    flex-direction: column;
    grid-row: 1 / span 2;
    gap: 2px;
    padding: 8px;
    color: var(--color-text, #333);
    overflow: clip;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .sorting-filter__options-inner::-webkit-scrollbar {
    display: none;
  }

  .facets-toggle--no-filters .sorting-filter__select-wrapper {
    padding-inline-start: 0;
  }

  .facets-mobile-wrapper .sorting-filter .facets__panel {
    padding-inline: 0;
    position: relative;
  }

  .facets-mobile-wrapper .sorting-filter .facets__status {
    display: none;
  }

  .facets-mobile-wrapper .sorting-filter .facets__label {
    margin-inline-end: 4px;
    font-size: 14px;
    color: var(--color-text, #333);
  }

  .facets-toggle .sorting-filter__container {
    padding: 0;
  }

  .facets-toggle .sorting-filter__container .facets__label {
    display: none;
  }

  .facets--drawer .sorting-filter {
    display: none;
  }

  @media screen and (min-width: 750px) {
    .facets--drawer .sorting-filter {
      display: block;
    }
  }

  .desktop\:hidden {
    display: block;
  }

  @media screen and (min-width: 750px) {
    .desktop\:hidden {
      display: none;
    }
  }

  .mobile\:hidden {
    display: none;
  }

  @media screen and (min-width: 750px) {
    .mobile\:hidden {
      display: block;
    }
  }
{% endstylesheet %}
